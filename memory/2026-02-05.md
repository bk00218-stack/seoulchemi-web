# 2026-02-05 작업 일지

## 오늘 작업 내용

Zeus가 화면을 볼 수 없어서 혼자 작업 진행.

### 주문 기능 API 개선 및 확장

#### 1. 주문 상세 API (`/api/orders/[id]`)
- GET: 주문 상세 조회 (아이템, 출고지시서, 작업로그 포함)
- PATCH: 주문 상태 변경 + 미수금 자동 연동
  - 출고(shipped) 시 → 미수금 자동 추가
  - 취소(cancelled) 시 → 출고됐던 주문이면 미수금 차감
- DELETE: 주문 삭제 (출고 전만 가능)

#### 2. 출고 관리 API (`/api/orders/[id]/shipping`)
- POST: 출고 지시서 생성
- PATCH: 출고 상태 업데이트 (피킹 → 포장 → 출고)
  - 출고 완료 시 택배사/운송장 입력 필수
  - 미수금 자동 처리

#### 3. 대시보드 API (`/api/orders/dashboard`)
- 오늘/어제/이번주/이번달/지난달 통계
- 상태별 주문 수
- 대기 중인 주문 목록
- 7일간 일별 추이
- 신용한도 초과 경고

#### 4. 출력 API (`/api/orders/[id]/print`)
- 거래명세서, 출고지시서, 납품확인서 출력용 데이터
- 출력 이력 자동 기록

#### 5. 주문 생성 API 개선 (`/api/orders/create`)
- 신용한도 체크 추가
- 작업 로그 기록
- 트랜잭션 처리

#### 6. 공통 타입 정의 (`/src/types/order.ts`)
- OrderStatus, OrderType, ShippingStatus 등 타입
- 상태별 라벨/색상 설정
- API 응답 타입 정의

### PM2 서버 관리
- lens-choice 앱으로 PM2 등록
- 자동 재시작 설정
- ecosystem.config.js 생성

## 테스트 결과
- `/api/orders/dashboard` API 정상 동작 확인
- 미수금 연동 로직 포함

## TODO (다음 작업)
- [ ] 주문 상세 페이지 UI 개선
- [ ] 출고 처리 페이지 생성
- [ ] 대시보드 페이지 생성
- [ ] 명세서 출력 페이지
- [ ] 바코드 스캔 기능

## 파일 변경 목록
- `src/app/api/orders/[id]/route.ts` (신규)
- `src/app/api/orders/[id]/shipping/route.ts` (신규)
- `src/app/api/orders/[id]/print/route.ts` (신규)
- `src/app/api/orders/dashboard/route.ts` (신규)
- `src/app/api/orders/create/route.ts` (수정)
- `src/types/order.ts` (신규)
- `ecosystem.config.js` (신규)
