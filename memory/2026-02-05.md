# 2026-02-05 작업 일지

## 오늘 작업 내용

Zeus가 화면을 볼 수 없어서 혼자 작업 진행.

### 주문 기능 API 개선 및 확장

#### 1. 주문 상세 API (`/api/orders/[id]`)
- GET: 주문 상세 조회 (아이템, 출고지시서, 작업로그 포함)
- PATCH: 주문 상태 변경 + 미수금 자동 연동
  - 출고(shipped) 시 → 미수금 자동 추가
  - 취소(cancelled) 시 → 출고됐던 주문이면 미수금 차감
- DELETE: 주문 삭제 (출고 전만 가능)

#### 2. 출고 관리 API (`/api/orders/[id]/shipping`)
- POST: 출고 지시서 생성
- PATCH: 출고 상태 업데이트 (피킹 → 포장 → 출고)
  - 출고 완료 시 택배사/운송장 입력 필수
  - 미수금 자동 처리

#### 3. 대시보드 API (`/api/orders/dashboard`)
- 오늘/어제/이번주/이번달/지난달 통계
- 상태별 주문 수
- 대기 중인 주문 목록
- 7일간 일별 추이
- 신용한도 초과 경고

#### 4. 출력 API (`/api/orders/[id]/print`)
- 거래명세서, 출고지시서, 납품확인서 출력용 데이터
- 출력 이력 자동 기록

#### 5. 주문 생성 API 개선 (`/api/orders/create`)
- 신용한도 체크 추가
- 작업 로그 기록
- 트랜잭션 처리

#### 6. 공통 타입 정의 (`/src/types/order.ts`)
- OrderStatus, OrderType, ShippingStatus 등 타입
- 상태별 라벨/색상 설정
- API 응답 타입 정의

### PM2 서버 관리
- lens-choice 앱으로 PM2 등록
- 자동 재시작 설정
- ecosystem.config.js 생성

## 테스트 결과
- `/api/orders/dashboard` API 정상 동작 확인
- 미수금 연동 로직 포함

## TODO (다음 작업)
- [x] 주문 상세 페이지 UI 개선
- [ ] 출고 처리 페이지 생성
- [ ] 대시보드 페이지 생성
- [x] 명세서 출력 페이지
- [ ] 바코드 스캔 기능

## 추가 작업 (오후)

### 로그인/인증 시스템 완료
- NextAuth + JWT 토큰 기반 인증
- 사용자 관리 CRUD
- 역할별 권한 (admin, manager, user, store)
- 관리자 계정: admin / admin1234

### 재고 관리 완료
- `/api/inventory` - 재고 조회/조정 API
- `/api/inventory/transactions` - 입출고 내역 API
- InventoryTransaction 모델 추가
- 재고 관리 페이지 (`/admin/products/inventory`)

### 반품/교환 완료
- `/api/returns` - 반품 CRUD API
- 반품 승인/입고/거절 처리
- 입고 시 재고 자동 증가, 미수금 차감
- 반품 관리 페이지 (`/admin/orders/returns`)
- Return, ReturnItem 모델 추가

### 문서 출력 완료
- `/admin/orders/[id]/print` - 출력 페이지
- 거래명세서, 출고지시서, 납품확인서 템플릿
- 브라우저 인쇄 기능

### 세금계산서 기본 완료
- `/api/tax-invoices` - 세금계산서 발행/조회 API
- TaxInvoice 모델 활용

## 최종 완료 현황 (ALL FEATURES!)
| 기능 | API | UI | 상태 |
|------|-----|-----|------|
| 로그인/권한 | ✅ | ✅ | **완료** |
| 재고 입출고 | ✅ | ✅ | **완료** |
| 문서 출력 | ✅ | ✅ | **완료** |
| 반품/교환 | ✅ | ✅ | **완료** |
| 세금계산서 | ✅ | ✅ | **완료** |
| 대시보드 | ✅ | ✅ | **완료** |
| 바코드 스캔 | ✅ | ✅ | **완료** |
| 리포트/통계 | ✅ | ✅ | **완료** |
| 모바일 앱(PWA) | ✅ | ✅ | **완료** |
| 알림 시스템 | ✅ | ✅ | **완료** |

## 테스트 결과
- API 테스트: 17/17 통과
- 페이지 로딩: 20/20 통과
- 쓰기 작업: 모두 정상

## 생성된 페이지 목록

### PC 관리자
- `/login` - 로그인
- `/admin` - 대시보드
- `/admin/orders` - 주문 목록
- `/admin/orders/new` - 주문 등록
- `/admin/orders/returns` - 반품/교환 관리
- `/admin/orders/scan` - 바코드 스캔
- `/admin/orders/[id]/print` - 문서 출력
- `/admin/stores` - 가맹점 관리
- `/admin/stores/receivables` - 미수금 현황
- `/admin/stores/receivables/deposit` - 입금 처리
- `/admin/stores/receivables/transactions` - 입출금 내역
- `/admin/stores/tax-invoices` - 세금계산서
- `/admin/products` - 상품 관리
- `/admin/products/brands` - 브랜드 관리
- `/admin/products/inventory` - 재고 관리
- `/admin/settings/users` - 사용자 관리
- `/admin/stats` - 통계/리포트

### 모바일 앱 (PWA)
- `/mobile` - 모바일 홈
- `/mobile/orders` - 주문 목록
- `/mobile/scan` - 바코드 스캔
- `/mobile/more` - 설정/더보기

## 접속 정보
- URL: http://192.168.1.7:3000
- 관리자: admin / admin1234

## 파일 변경 목록
- `src/app/api/orders/[id]/route.ts` (신규)
- `src/app/api/orders/[id]/shipping/route.ts` (신규)
- `src/app/api/orders/[id]/print/route.ts` (신규)
- `src/app/api/orders/dashboard/route.ts` (신규)
- `src/app/api/orders/create/route.ts` (수정)
- `src/types/order.ts` (신규)
- `ecosystem.config.js` (신규)
